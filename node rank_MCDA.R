# Data for N1
consequences_N1 <- c("C1", "C2", "C3","C4", "C5", "C6","C7", "C8", "C9","C10", "C11", "C12","C13", "C14", "C15")
severity_N1 <- c(4, 2, 4,2, 1, 1, 1, 4, 2, 2, 3, 2, 4, 2, 2)
likelihood_N1 <- c( 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 2, 2)


# Data for N2
consequences_N2 <- c("C16", "C17", "C18","C19", "C20", "C21", "C22", "C23", "C24","C25")
severity_N2 <- c(4, 2, 3, 4, 3, 2, 4, 2, 2, 4)
likelihood_N2 <- c( 1, 2, 2, 1, 1, 2, 1, 2, 1, 1)

# Data for N3
consequences_N3 <- c("C26", "C27", "C28","C29", "C30", "C31")
severity_N3 <- c(2, 2, 4, 3, 2, 3)
likelihood_N3 <- c(2, 2, 1, 2, 2, 2)

# Data for N4
consequences_N4 <- c( "c32", "c33", "c34", "c35", "c36", "c37", "c38", "c39", "c40", "C41", "C42", "C43","C44", "C45", "C46")
severity_N4 <- c(2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 4, 4, 2, 1, 1)
likelihood_N4 <- c(1, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 2, 1, 1, 1)


# Data for N5
consequences_N5 <- c("c47", "c48", "c49", "c50", "c51", "c52", "c53", "c54", "c55", "C56", "C57", "C58")
severity_N5 <- c(2, 2, 2, 2, 2, 2, 2, 3, 4, 3, 3, 4)
likelihood_N5 <- c(2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 2)


# Data for N6
consequences_N6 <- c("c59", "c60", "c61", "c62", "c63", "c64", "c65", "c66", "c67", "C68")
severity_N6 <- c(2, 4, 2, 4, 2, 4, 3, 2, 2, 2)
likelihood_N6 <- c(1, 1, 1, 1, 1, 1, 1, 2, 2, 2)


# Data for N7
consequences_N7 <- c("c69", "c70", "c71", "c72", "c73", "c74", "c75", "c76", "c77")
severity_N7 <- c(2,2,2,2,2,4,4,2,3)
likelihood_N7 <- c(1,1,2,2,1,1,2,1,2)


# Data for N8
consequences_N8 <- c("c78", "c79", "c80", "c81", "c82", "c83")
severity_N8 <- c(1,3,1,3,3,4)
likelihood_N8 <- c(1,1,1,1,1,1)


# Data for N9
consequences_N9 <- c("c84", "c85", "c86", "c87", "c88", "c89", "c90", "c91", "c92", "C93", "c94", "c95", "c96", "c97", "c98", "c99")
severity_N9 <- c(2,1,1,2,1,1,4,1,1,1,1,1,1,1,2,3)
likelihood_N9 <- c(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1)

# Data for N10
consequences_N10 <- c("c100", "c101", "c102", "c103", "c104", "c105", "c106", "c107", "c108", "C109", "c110", "c111", "c112", "c113")
severity_N10 <- c(2,2,1,1,1,1,3,3,3,2,4,2,4,4)
likelihood_N10 <- c(1,1,1,3,3,3,2,1,1,2,1,1,1,1)

# Data for N11
consequences_N11 <- c("c114", "c115", "c116", "c117", "c118", "c119", "c120", "c121", "c122", "C123", "c124", "c125")
severity_N11 <- c(4,3,3,4,3,3,3,4,2,2,2,2)
likelihood_N11 <- c(1,1,1,1,1,1,1,1,3,3,3,1)

# Data for N12
consequences_N12 <- c("c126", "c127", "c128", "c129", "c130", "c131", "c132", "c133", "c134", "C135", "c136", "c137")
severity_N12 <- c(2,4,4,4,2,4,2,2,2,2,2,2)
likelihood_N12 <- c(1,1,1,1,1,1,1,1,1,1,1,1)

# Data for N13
consequences_N13 <- c("c138", "c139", "c140", "c141", "c142", "c143", "c144")
severity_N13 <- c(4,2,2,2,2,2,4)
likelihood_N13 <- c(1,1,1,3,3,3,1)

# Data for N14
consequences_N14 <- c("c145", "c146", "c147", "c148", "c149", "c150", "c151", "c152")
severity_N14 <- c(2,2,2,2,2,2,2,2)
likelihood_N14 <- c(2,2,2,2,2,2,2,2)

# Data for N15
consequences_N15 <- c("c153", "c154", "c155", "c156", "c157")
severity_N15 <- c(2,2,2,2,2)
likelihood_N15 <- c(1,1,2,2,2)

# Data for N16
consequences_N16 <- c("c158", "c159", "c160")
severity_N16 <- c(2,2,2)
likelihood_N16 <- c(1, 1, 1)

# Data for N17
consequences_N17 <- c("c161", "c162", "c163", "c164", "c165")
severity_N17 <- c(1,2,2,1,2)
likelihood_N17 <- c(1, 1, 1, 1, 1)

# Data for N18
consequences_N18 <- c("c166", "c167", "c168", "c169", "c170")
severity_N18 <- c(2,2,1,2,2)
likelihood_N18 <- c(2,2,3,2,3)

# Data for N19
consequences_N19 <- c("c171", "c172", "c173", "c174", "c175", "c176", "c177")
severity_N19 <- c(2,2,2,1,2,2,2)
likelihood_N19 <- c(2,2,1,3,2,2,3)

# Data for N20
consequences_N20 <- c("c178", "c179", "c180")
severity_N20 <- c(3,3,3)
likelihood_N20 <- c(1, 1, 1)

# Data for N21
consequences_N21 <- c("c181", "c182", "c183")
severity_N21 <- c(4,3,3)
likelihood_N21 <- c(1, 2,1)

# Data for N22
consequences_N22 <- c("c184", "c185", "c186", "c187", "c188")
severity_N22 <- c(2,2,2,1,2)
likelihood_N22 <- c(2,2,3,2,2)

# Data for N23
consequences_N23 <- c("c189", "c190")
severity_N23 <- c(3,1)
likelihood_N23 <- c(3,1)

# Data for N24
consequences_N24 <- c("c191", "c192")
severity_N24 <- c(3,2)
likelihood_N24 <- c(2,1)

# Data for N25
consequences_N25 <- c("c193", "c194")
severity_N25 <- c(3,2)
likelihood_N25 <- c(2,1)

# Data for N26
consequences_N26 <- c("c195", "c196")
severity_N26 <- c(2,1)
likelihood_N26 <- c(2,3)

# Load required libraries
library(dplyr)

# Combine data for all nodes
#data_all_nodes <- rbind(
  #data.frame(Node = "N1", Consequence = consequences_N1, Severity = severity_N1, Likelihood = likelihood_N1),
  #data.frame(Node = "N2", Consequence = consequences_N2, Severity = severity_N2, Likelihood = likelihood_N2),
  #data.frame(Node = "N3", Consequence = consequences_N3, Severity = severity_N3, Likelihood = likelihood_N3),
  #data.frame(Node = "N4", Consequence = consequences_N4, Severity = severity_N4, Likelihood = likelihood_N4),
  #data.frame(Node = "N5", Consequence = consequences_N5, Severity = severity_N5, Likelihood = likelihood_N5),
  #data.frame(Node = "N6", Consequence = consequences_N6, Severity = severity_N6, Likelihood = likelihood_N6),
  #data.frame(Node = "N7", Consequence = consequences_N7, Severity = severity_N7, Likelihood = likelihood_N7),
  #data.frame(Node = "N8", Consequence = consequences_N8, Severity = severity_N8, Likelihood = likelihood_N8),
  #data.frame(Node = "N9", Consequence = consequences_N9, Severity = severity_N9, Likelihood = likelihood_N9),
  #data.frame(Node = "N10", Consequence = consequences_N10, Severity = severity_N10, Likelihood = likelihood_N10),
  #data.frame(Node = "N11", Consequence = consequences_N11, Severity = severity_N11, Likelihood = likelihood_N11),
  #data.frame(Node = "N12", Consequence = consequences_N12, Severity = severity_N12, Likelihood = likelihood_N12),
  #data.frame(Node = "N13", Consequence = consequences_N13, Severity = severity_N13, Likelihood = likelihood_N13),
  #data.frame(Node = "N14", Consequence = consequences_N14, Severity = severity_N14, Likelihood = likelihood_N14),
  #data.frame(Node = "N15", Consequence = consequences_N15, Severity = severity_N15, Likelihood = likelihood_N15),
  #data.frame(Node = "N16", Consequence = consequences_N16, Severity = severity_N16, Likelihood = likelihood_N16),
  #data.frame(Node = "N17", Consequence = consequences_N17, Severity = severity_N17, Likelihood = likelihood_N17),
  #data.frame(Node = "N18", Consequence = consequences_N18, Severity = severity_N18, Likelihood = likelihood_N18),
  #data.frame(Node = "N19", Consequence = consequences_N19, Severity = severity_N19, Likelihood = likelihood_N19),
  #data.frame(Node = "N20", Consequence = consequences_N20, Severity = severity_N20, Likelihood = likelihood_N20),
  #data.frame(Node = "N21", Consequence = consequences_N21, Severity = severity_N21, Likelihood = likelihood_N21),
  #data.frame(Node = "N22", Consequence = consequences_N22, Severity = severity_N22, Likelihood = likelihood_N22),
  #data.frame(Node = "N23", Consequence = consequences_N23, Severity = severity_N23, Likelihood = likelihood_N23),
  #data.frame(Node = "N24", Consequence = consequences_N24, Severity = severity_N24, Likelihood = likelihood_N24),
  #data.frame(Node = "N25", Consequence = consequences_N25, Severity = severity_N25, Likelihood = likelihood_N25),
  #data.frame(Node = "N26", Consequence = consequences_N26, Severity = severity_N26, Likelihood = likelihood_N26)
#)

# Create data frames for all nodes
data_N1 <- data.frame(Node = "N1", Severity = severity_N1, Likelihood = likelihood_N1)
data_N2 <- data.frame(Node = "N2", Severity = severity_N2, Likelihood = likelihood_N2)
data_N3 <- data.frame(Node = "N3", Severity = severity_N3, Likelihood = likelihood_N3)
data_N4 <- data.frame(Node = "N4", Severity = severity_N4, Likelihood = likelihood_N4)
data_N5 <- data.frame(Node = "N5", Severity = severity_N5, Likelihood = likelihood_N5)
data_N6 <- data.frame(Node = "N6", Severity = severity_N6, Likelihood = likelihood_N6)
data_N7 <- data.frame(Node = "N7", Severity = severity_N7, Likelihood = likelihood_N7)
data_N8 <- data.frame(Node = "N8", Severity = severity_N8, Likelihood = likelihood_N8)
data_N9 <- data.frame(Node = "N9", Severity = severity_N9, Likelihood = likelihood_N9)
data_N10 <- data.frame(Node = "N10", Severity = severity_N10, Likelihood = likelihood_N10)
data_N11 <- data.frame(Node = "N11", Severity = severity_N11, Likelihood = likelihood_N11)
data_N12 <- data.frame(Node = "N12", Severity = severity_N12, Likelihood = likelihood_N12)
data_N13 <- data.frame(Node = "N13", Severity = severity_N13, Likelihood = likelihood_N13)
data_N14 <- data.frame(Node = "N14", Severity = severity_N14, Likelihood = likelihood_N14)
data_N15 <- data.frame(Node = "N15", Severity = severity_N15, Likelihood = likelihood_N15)
data_N16 <- data.frame(Node = "N16", Severity = severity_N16, Likelihood = likelihood_N16)
data_N17 <- data.frame(Node = "N17", Severity = severity_N17, Likelihood = likelihood_N17)
data_N18 <- data.frame(Node = "N18", Severity = severity_N18, Likelihood = likelihood_N18)
data_N19 <- data.frame(Node = "N19", Severity = severity_N19, Likelihood = likelihood_N19)
data_N20 <- data.frame(Node = "N20", Severity = severity_N20, Likelihood = likelihood_N20)
data_N21 <- data.frame(Node = "N21", Severity = severity_N21, Likelihood = likelihood_N21)
data_N22 <- data.frame(Node = "N22", Severity = severity_N22, Likelihood = likelihood_N22)
data_N23 <- data.frame(Node = "N23", Severity = severity_N23, Likelihood = likelihood_N23)
data_N24 <- data.frame(Node = "N24", Severity = severity_N24, Likelihood = likelihood_N24)
data_N25 <- data.frame(Node = "N25", Severity = severity_N25, Likelihood = likelihood_N25)
data_N26 <- data.frame(Node = "N26", Severity = severity_N26, Likelihood = likelihood_N26)



# Calculate the Average Overall Risk Score method (for each node)
avg_overall_risk_score <- bind_rows(data_N1, data_N2, data_N3, data_N4, data_N5, data_N6, data_N7, data_N8, data_N9, data_N10, data_N11, data_N12, data_N13, data_N14, data_N15,data_N16, data_N17, data_N18, data_N19, data_N20, data_N21, data_N22, data_N23, data_N24, data_N25, data_N26) %>%
  group_by(Node) %>%
  mutate(
    Risk_Score = Severity * Likelihood,
    Rank_Avg_Score = rank(-Risk_Score)  # Ranking in descending order
  ) %>%
  ungroup()

# Function to calculate Overall Risk Score for each consequence
calculate_overall_risk <- function(severity, likelihood) {
  return(severity * likelihood)
}

# Calculate Overall Risk Score for each consequence in each node
data_all_nodes$Overall_Risk <- calculate_overall_risk(data_all_nodes$Severity, data_all_nodes$Likelihood)

# Calculate Average Overall Risk Score for each node
average_risk_per_node <- data_all_nodes %>%
  group_by(Node) %>%
  summarize(Average_Risk = mean(Overall_Risk))

# Rank the nodes based on their Average Overall Risk Score
ranked_nodes_avg_score <- average_risk_per_node %>%
  arrange(Average_Risk) %>%
  mutate(Rank = rank(Average_Risk))

print(ranked_nodes_avg_score)


# Load required libraries
library(ggplot2)

# Combine data for all nodes (if not done already)
# Code from the previous step
# ...

# Rank the nodes based on their Average Overall Risk Score
ranked_nodes_avg_score <- average_risk_per_node %>%
  arrange(Average_Risk) %>%
  mutate(Rank = rank(-Average_Risk)) # Use negative sign to reverse the order for higher ranks

# Plot the ranked nodes using a bar chart
ggplot(ranked_nodes_avg_score, aes(x = reorder(Node, Rank), y = Average_Risk, fill = Node)) +
  geom_bar(stat = "identity", width = 0.6) +
  geom_text(aes(label = Rank), vjust = -0.5) +
  labs(title = "Ranked Nodes by Criticality", x = "Node", y = "Average Risk Level") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# MCDA technique (AHP)

# Load required libraries
library(dplyr)

# Combine data for all nodes (if not done already)
# Code from the previous step
# ...

# Calculate the weights of Severity and Likelihood using AHP
calculate_ahp_weights <- function(severity, likelihood) {
  library(Rcpp)
  library(RcppEigen)
  
  # Create a matrix of pairwise comparisons
  comparison_matrix <- matrix(1, nrow = 2, ncol = 2)
  comparison_matrix[1, 2] <- severity
  comparison_matrix[2, 1] <- 1 / severity
  comparison_matrix[2, 1] <- likelihood
  comparison_matrix[1, 2] <- 1 / likelihood
  
  # Calculate the AHP weights
  eigen_result <- eigen(comparison_matrix)
  weights <- eigen_result$vectors[, 1] / sum(eigen_result$vectors[, 1])
  
  return(weights)
}

# Calculate AHP weights for Severity and Likelihood
weights_severity <- calculate_ahp_weights(4, 2)  # Replace 4 and 2 with your own judgments
weights_likelihood <- calculate_ahp_weights(2, 1)  # Replace 2 and 1 with your own judgments

# Function to calculate Overall Risk Score for each consequence
calculate_overall_risk <- function(severity, likelihood, weights_severity, weights_likelihood) {
  return(severity * weights_severity + likelihood * weights_likelihood)
}

# Calculate Overall Risk Score for each consequence in each node
data_all_nodes$Overall_Risk <- calculate_overall_risk(data_all_nodes$Severity, data_all_nodes$Likelihood, weights_severity, weights_likelihood)

# Calculate Average Overall Risk Score for each node
average_risk_per_node <- data_all_nodes %>%
  group_by(Node) %>%
  summarize(Average_Risk = mean(Overall_Risk))

# Rank the nodes based on their Average Overall Risk Score
ranked_nodes_ahp <- average_risk_per_node %>%
  arrange(Average_Risk) %>%
  mutate(Rank_AHP = rank(-Average_Risk)) # Use negative sign to reverse the order for higher ranks

print(ranked_nodes_ahp)

# Ploting

# Load required libraries
library(ggplot2)



# Rank the nodes based on their Average Overall Risk Score
ranked_nodes <- average_risk_per_node %>%
  arrange(Average_Risk) %>%
  mutate(Rank = rank(-Average_Risk)) # Use negative sign to reverse the order for higher ranks

# Plot the ranked nodes using a bar chart
ggplot(ranked_nodes_ahp, aes(x = reorder(Node, Rank_AHP), y = Average_Risk, fill = Node)) +
  geom_bar(stat = "identity", width = 0.6) +
  geom_text(aes(label = Rank_AHP), vjust = -0.5) +
  labs(title = "Ranked Nodes by Criticality (Using AHP)", x = "Node", y = "Average Risk Level") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))



# WSM method and TOPSIS

# Load required libraries
library(dplyr)
library(ggplot2)

# Create data frames for all nodes
data_all_nodes <- list()

# Data for N1
data_all_nodes$N1 <- data.frame(
  Node = "N1",
  Consequences = c("C1", "C2", "C3", "C4", "C5", "C6", "C7", "C8", "C9", "C10", "C11", "C12", "C13", "C14", "C15"),
  Severity = c(4, 2, 4, 2, 1, 1, 1, 4, 2, 2, 3, 2, 4, 2, 2),
  Likelihood = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 2, 2)
)

# Data for N2
data_all_nodes$N2 <- data.frame(
  Node = "N2",
  Consequences = c("C16", "C17", "C18", "C19", "C20", "C21", "C22", "C23", "C24", "C25"),
  Severity = c(4, 2, 3, 4, 3, 2, 4, 2, 2, 4),
  Likelihood = c(1, 2, 2, 1, 1, 2, 1, 2, 1, 1)
)

# Data for N3
data_all_nodes$N3 <- data.frame(
  Node = "N3",
  Consequences = c("C26", "C27", "C28", "C29", "C30", "C31"),
  Severity = c(2, 2, 4, 3, 2, 3),
  Likelihood = c(2, 2, 1, 2, 2, 2)
)

# Data for N4
data_all_nodes$N4 <- data.frame(
  Node = "N4",
  Consequences = c("c32", "c33", "c34", "c35", "c36", "c37", "c38", "c39", "c40", "C41", "C42", "C43", "C44", "C45", "C46"),
  Severity = c(2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 4, 4, 2, 1, 1),
  Likelihood = c(1, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 2, 1, 1, 1)
)

# Data for N5
data_all_nodes$N5 <- data.frame(
  Node = "N5",
  Consequences = c("c47", "c48", "c49", "c50", "c51", "c52", "c53", "c54", "c55", "C56", "C57", "C58"),
  Severity = c(2, 2, 2, 2, 2, 2, 2, 3, 4, 3, 3, 4),
  Likelihood = c(2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 2)
)

# Data for N6
data_all_nodes$N6 <- data.frame(
  Node = "N6",
  Consequences = c("c59", "c60", "c61", "c62", "c63", "c64", "c65", "c66", "c67", "C68"),
  Severity = c(2, 4, 2, 4, 2, 4, 3, 2, 2, 2),
  Likelihood = c(1, 1, 1, 1, 1, 1, 1, 2, 2, 2)
)

# Data for N7
data_all_nodes$N7 <- data.frame(
  Node = "N7",
  Consequences = c("c69", "c70", "c71", "c72", "c73", "c74", "c75", "c76", "c77"),
  Severity = c(2,2,2,2,2,4,4,2,3),
  Likelihood = c(1,1,2,2,1,1,2,1,2)
)

# Data for N8
data_all_nodes$N8 <- data.frame(
  Node = "N8",
  Consequences = c("c78", "c79", "c80", "c81", "c82", "c83"),
  Severity = c(1, 3, 1, 3, 3, 4),
  Likelihood = c(1, 1, 1, 1, 1, 1)
)

# Data for N9
data_all_nodes$N9 <- data.frame(
  Node = "N9",
  Consequences = c("c84", "c85", "c86", "c87", "c88", "c89", "c90", "c91", "c92", "C93", "c94", "c95", "c96", "c97", "c98", "c99"),
  Severity = c(2, 1, 1, 2, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 1),
  Likelihood = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)
)

# Data for N10
data_all_nodes$N10 <- data.frame(
  Node = "N10",
  Consequences = c("c100", "c101", "c102", "c103", "c104", "c105", "c106", "c107", "c108", "C109", "c110", "c111", "c112", "c113"),
  Severity = c(2, 2, 1, 1, 1, 1, 3, 3, 3, 2, 4, 2, 4, 4),
  Likelihood = c(1, 1, 1, 3, 3, 3, 2, 1, 1, 2, 1, 1, 1, 1)
)

# Data for N11
data_all_nodes$N11 <- data.frame(
  Node = "N11",
  Consequences = c("c114", "c115", "c116", "c117", "c118", "c119", "c120", "c121", "c122", "C123", "c124", "c125"),
  Severity = c(4,3,3,4,3,3,3,4,2,2,2,2),
  Likelihood = c(1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 1)
)

# Data for N12
data_all_nodes$N12 <- data.frame(
  Node = "N12",
  Consequences = c("c126", "c127", "c128", "c129", "c130", "c131", "c132", "c133", "c134", "C135", "c136", "c137"),
  Severity = c(2,4,4,4,2,4,2,2,2,2,2,2),
  Likelihood = c(1,1,1,1,1,1,1,1,1,1,1,1)
)

# Data for N13
data_all_nodes$N13 <- data.frame(
  Node = "N13",
  Consequences = c("c138", "c139", "c140", "c141", "c142", "c143", "c144", "c145", "c146", "C147", "c148", "c149"),
  Severity = c(2, 4, 4, 2, 4, 2, 2, 2, 2, 2, 2, 4),
  Likelihood = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)
)

# Data for N14
data_all_nodes$N14 <- data.frame(
  Node = "N14",
  Consequences = c("c150", "c151", "c152", "c153", "c154", "c155", "c156", "c157", "c158", "C159", "c160", "c161"),
  Severity = c(3, 4, 4, 4, 4, 4, 4, 4, 4, 3, 4, 4),
  Likelihood = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)
)

# Data for N15
data_all_nodes$N15 <- data.frame(
  Node = "N15",
  Consequences = c("c162", "c163", "c164", "c165", "c166", "c167", "c168", "c169", "c170", "C171", "c172", "c173", "c174", "c175"),
  Severity = c(4, 3, 3, 4, 3, 3, 3, 3, 3, 4, 2, 2, 4, 4),
  Likelihood = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)
)

# Data for N16
data_all_nodes$N16 <- data.frame(
  Node = "N16",
  Consequences = c("c176", "c177", "c178", "c179", "c180", "c181", "c182", "c183", "c184", "C185", "c186", "c187", "c188", "c189"),
  Severity = c(2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2),
  Likelihood = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)
)

# Data for N17
data_all_nodes$N17 <- data.frame(
  Node = "N17",
  Consequences = c("c190", "c191", "c192", "c193", "c194", "c195", "c196", "c197", "c198", "C199", "c200", "c201"),
  Severity = c(2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2),
  Likelihood = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)
)

# Data for N18
data_all_nodes$N18 <- data.frame(
  Node = "N18",
  Consequences = c("c202", "c203", "c204", "c205", "c206", "c207", "c208", "c209", "c210", "C211", "c212", "c213", "c214", "c215"),
  Severity = c(4, 4, 2, 3, 3, 4, 4, 2, 2, 3, 4, 4, 3, 3),
  Likelihood = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)
)

# Data for N19
data_all_nodes$N19 <- data.frame(
  Node = "N19",
  Consequences = c("c216", "c217", "c218", "c219", "c220", "c221", "c222", "c223", "c224", "C225", "c226", "c227", "c228", "c229"),
  Severity = c(4, 3, 3, 4, 3, 3, 3, 3, 3, 4, 2, 2, 4, 4),
  Likelihood = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)
)

# Data for N20
data_all_nodes$N20 <- data.frame(
  Node = "N20",
  Consequences = c("c230", "c231", "c232", "c233", "c234", "c235", "c236", "c237", "c238", "C239", "c240", "c241", "c242", "c243"),
  Severity = c(2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2),
  Likelihood = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)
)

# Data for N21
data_all_nodes$N21 <- data.frame(
  Node = "N21",
  Consequences = c("c244", "c245", "c246", "c247", "c248", "c249", "c250", "c251", "c252", "C253", "c254", "c255", "c256", "c257"),
  Severity = c(4, 3, 3, 4, 3, 3, 3, 3, 3, 4, 2, 2, 4, 4),
  Likelihood = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)
)

# Data for N22
data_all_nodes$N22 <- data.frame(
  Node = "N22",
  Consequences = c("c258", "c259", "c260", "c261", "c262", "c263", "c264", "c265", "c266", "C267", "c268", "c269", "c270", "c271"),
  Severity = c(4, 2, 2, 3, 3, 4, 4, 2, 2, 3, 4, 4, 3, 3),
  Likelihood = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)
)

# Data for N23
data_all_nodes$N23 <- data.frame(
  Node = "N23",
  Consequences = c("c272", "c273", "c274", "c275", "c276", "c277", "c278", "c279", "c280", "C281", "c282", "c283", "c284", "c285"),
  Severity = c(2, 3, 3, 2, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2),
  Likelihood = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)
)

# Data for N24
data_all_nodes$N24 <- data.frame(
  Node = "N24",
  Consequences = c("c286", "c287", "c288", "c289", "c290", "c291", "c292", "c293", "c294", "C295", "c296", "c297", "c298", "c299"),
  Severity = c(4, 3, 3, 4, 3, 3, 3, 3, 3, 4, 2, 2, 4, 4),
  Likelihood = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)
)

# Data for N25
data_all_nodes$N25 <- data.frame(
  Node = "N25",
  Consequences = c("c300", "c301", "c302", "c303", "c304", "c305", "c306", "c307", "c308", "C309", "c310", "c311", "c312", "c313"),
  Severity = c(2, 3, 3, 2, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2),
  Likelihood = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)
)

# Data for N26
data_all_nodes$N26 <- data.frame(
  Node = "N26",
  Consequences = c("c314", "c315", "c316", "c317", "c318", "c319", "c320", "c321", "c322", "C323", "c324", "c325", "c326", "c327"),
  Severity = c(2, 3, 3, 2, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2),
  Likelihood = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1)
)

# ...

# Combine data frames for all nodes into a single data frame
data_all_nodes <- bind_rows(data_all_nodes)

# Step 1: Define the Weights (arbitrary example for WSM)
weight_severity <- 0.6
weight_likelihood <- 0.4

# Step 2: Calculate Overall Risk Score for each Node (WSM)
data_all_nodes$Overall_Risk_WSM <- data_all_nodes$Severity * weight_severity + data_all_nodes$Likelihood * weight_likelihood

# Step 3: Rank the Nodes based on Overall Risk Score (WSM)
ranked_nodes_wsm <- data_all_nodes %>%
  select(Node, Overall_Risk_WSM) %>%
  arrange(Overall_Risk_WSM) %>%
  mutate(Rank_WSM = rank(Overall_Risk_WSM))

# Step 4: Normalize the Decision Matrix for TOPSIS
normalized_data <- data_all_nodes %>%
  mutate(
    Severity_Normalized = Severity / max(Severity),
    Likelihood_Normalized = Likelihood / min(Likelihood)
  )

# Step 5: Determine the Ideal and Negative-Ideal Solutions for TOPSIS
ideal_solution <- normalized_data %>%
  summarise(
    Ideal_Severity = max(Severity_Normalized),
    Ideal_Likelihood = min(Likelihood_Normalized)
  )

negative_ideal_solution <- normalized_data %>%
  summarise(
    Negative_Ideal_Severity = min(Severity_Normalized),
    Negative_Ideal_Likelihood = max(Likelihood_Normalized)
  )

# Step 6: Calculate the Distance to Ideal Solution and Negative-Ideal Solution for TOPSIS
normalized_data <- normalized_data %>%
  mutate(
    Distance_Ideal = sqrt((Severity_Normalized - ideal_solution$Ideal_Severity)^2 + (Likelihood_Normalized - ideal_solution$Ideal_Likelihood)^2),
    Distance_Negative_Ideal = sqrt((Severity_Normalized - negative_ideal_solution$Negative_Ideal_Severity)^2 + (Likelihood_Normalized - negative_ideal_solution$Negative_Ideal_Likelihood)^2)
  )

# Step 7: Calculate the Relative Closeness to Ideal Solution for TOPSIS
normalized_data$Relative_Closeness <- normalized_data$Distance_Negative_Ideal / (normalized_data$Distance_Ideal + normalized_data$Distance_Negative_Ideal)

# Step 8: Rank the Nodes based on Relative Closeness (TOPSIS)
ranked_nodes_topsis <- normalized_data %>%
  select(Node, Relative_Closeness) %>%
  arrange(desc(Relative_Closeness)) %>%
  mutate(Rank_TOPSIS = rank(-Relative_Closeness))

# Plot the ranked nodes using a bar chart
p_wsm <- ggplot(ranked_nodes_wsm, aes(x = reorder(Node, Rank_WSM), y = Overall_Risk_WSM)) +
  geom_bar(stat = "identity", fill = "blue", width = 0.6) +
  geom_text(aes(label = Rank_WSM), vjust = -0.5, color = "white", size = 4, position = position_dodge(width = 0.6)) +
  labs(title = "Ranked Nodes by Criticality (WSM)", x = "Node", y = "Overall Risk Level") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Plot the ranked nodes for TOPSIS
p_topsis <- ggplot(ranked_nodes_topsis, aes(x = reorder(Node, Rank_TOPSIS), y = Relative_Closeness)) +
  geom_bar(stat = "identity", fill = "green", width = 0.6) +
  geom_text(aes(label = Rank_TOPSIS), vjust = -0.5, color = "white", size = 4, position = position_dodge(width = 0.6)) +
  labs(title = "Ranked Nodes by Criticality (TOPSIS)", x = "Node", y = "Relative Closeness") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Display both plots side by side
library(gridExtra)
grid.arrange(p_wsm, p_topsis, ncol = 2)

# single WSM not bar

# Load required libraries
library(dplyr)
library(ggplot2)

# Combine data frames for all nodes into a single data frame
data_all_nodes <- bind_rows(data_all_nodes)

# Step 1: Define the Weights (arbitrary example for WSM)
weight_severity <- 0.6
weight_likelihood <- 0.4

# Step 2: Calculate Overall Risk Score for each Node (WSM)
data_all_nodes$Overall_Risk_WSM <- data_all_nodes$Severity * weight_severity + data_all_nodes$Likelihood * weight_likelihood

# Step 3: Rank the Nodes based on Overall Risk Score (WSM)
ranked_nodes_wsm <- data_all_nodes %>%
  select(Node, Overall_Risk_WSM) %>%
  arrange(Overall_Risk_WSM) %>%
  mutate(Rank_WSM = rank(Overall_Risk_WSM))

# Plot the ranked nodes based on Overall Risk Score (WSM)
ggplot(ranked_nodes_wsm, aes(x = Rank_WSM, y = Overall_Risk_WSM, label = Node)) +
  geom_point(color = "blue", size = 3) +
  geom_line(color = "blue") +
  geom_text(vjust = -0.5, hjust = 0.5, size = 3) +
  labs(title = "Ranked Nodes based on Overall Risk Score (WSM)",
       x = "Rank",
       y = "Overall Risk Score") +
  theme_minimal()



# WSM bar plot

# Load required libraries
library(dplyr)
library(ggplot2)

# Combine data frames for all nodes into a single data frame
data_all_nodes <- bind_rows(data_all_nodes)

# Step 1: Define the Weights (arbitrary example for WSM)
weight_severity <- 0.6
weight_likelihood <- 0.4

# Step 2: Calculate Overall Risk Score for each Node (WSM)
data_all_nodes$Overall_Risk_WSM <- data_all_nodes$Severity * weight_severity + data_all_nodes$Likelihood * weight_likelihood

# Step 3: Rank the Nodes based on Overall Risk Score (WSM)
ranked_nodes_wsm <- data_all_nodes %>%
  select(Node, Overall_Risk_WSM) %>%
  arrange(Overall_Risk_WSM) %>%
  mutate(Rank_WSM = rank(Overall_Risk_WSM))

# Plot the ranked nodes using a bar chart (WSM)
ggplot(ranked_nodes_wsm, aes(x = reorder(Node, Overall_Risk_WSM), y = Overall_Risk_WSM)) +
  geom_bar(stat = "identity", fill = "blue") +
  geom_text(aes(label = round(Overall_Risk_WSM, 2)), vjust = -0.5, size = 3) +
  labs(title = "Ranked Nodes based on Overall Risk Score (WSM)",
       x = "Node",
       y = "Overall Risk Score") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


#TOPSIS bar plot

# Load required libraries
library(dplyr)
library(ggplot2)

# Combine data frames for all nodes into a single data frame
data_all_nodes <- bind_rows(data_all_nodes)

# Step 1: Define the Weights (arbitrary example for WSM)
weight_severity <- 0.6
weight_likelihood <- 0.4

# Step 2: Calculate Overall Risk Score for each Node (WSM)
data_all_nodes$Overall_Risk_WSM <- data_all_nodes$Severity * weight_severity + data_all_nodes$Likelihood * weight_likelihood

# Step 3: Rank the Nodes based on Overall Risk Score (WSM)
ranked_nodes_wsm <- data_all_nodes %>%
  select(Node, Overall_Risk_WSM) %>%
  arrange(Overall_Risk_WSM) %>%
  mutate(Rank_WSM = rank(-Overall_Risk_WSM))  # Use negative sign for descending order

# Plot the ranked nodes using a bar chart (WSM)
ggplot(ranked_nodes_wsm, aes(x = reorder(Node, Rank_WSM), y = Overall_Risk_WSM)) +
  geom_bar(stat = "identity", fill = "blue") +
  geom_text(aes(label = round(Overall_Risk_WSM, 2)), vjust = -0.5, size = 3) +
  labs(title = "Ranked Nodes based on Overall Risk Score (WSM)",
       x = "Node",
       y = "Overall Risk Score") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Step 1: Normalize the data for TOPSIS (using min-max normalization)
data_all_nodes_normalized <- data_all_nodes %>%
  group_by(Node) %>%
  mutate(
    Severity_Normalized = (Severity - min(Severity)) / (max(Severity) - min(Severity)),
    Likelihood_Normalized = (Likelihood - min(Likelihood)) / (max(Likelihood) - min(Likelihood))
  )

# Step 2: Calculate Weighted Normalized Scores for each Node (TOPSIS)
data_all_nodes_normalized$Weighted_Score_TOPSIS <- data_all_nodes_normalized$Severity_Normalized * weight_severity +
  data_all_nodes_normalized$Likelihood_Normalized * weight_likelihood

# Step 3: Calculate the Positive Ideal Solution and Negative Ideal Solution (TOPSIS)
positive_ideal <- data_all_nodes_normalized %>%
  summarise(
    max_severity = max(Severity_Normalized),
    max_likelihood = max(Likelihood_Normalized)
  )

negative_ideal <- data_all_nodes_normalized %>%
  summarise(
    min_severity = min(Severity_Normalized),
    min_likelihood = min(Likelihood_Normalized)
  )

# Step 4: Calculate the Euclidean Distances to Positive Ideal Solution and Negative Ideal Solution (TOPSIS)
data_all_nodes_normalized <- data_all_nodes_normalized %>%
  mutate(
    distance_to_positive_ideal = sqrt((Severity_Normalized - positive_ideal$max_severity)^2 +
                                        (Likelihood_Normalized - positive_ideal$max_likelihood)^2),
    distance_to_negative_ideal = sqrt((Severity_Normalized - negative_ideal$min_severity)^2 +
                                        (Likelihood_Normalized - negative_ideal$min_likelihood)^2)
  )

# Step 5: Calculate the TOPSIS Score for each Node
data_all_nodes_normalized$TOPSIS_Score <- data_all_nodes_normalized$distance_to_negative_ideal /
  (data_all_nodes_normalized$distance_to_positive_ideal +
     data_all_nodes_normalized$distance_to_negative_ideal)

# Step 6: Rank the Nodes based on TOPSIS Score
ranked_nodes_topsis <- data_all_nodes_normalized %>%
  select(Node, TOPSIS_Score) %>%
  arrange(TOPSIS_Score) %>%
  mutate(Rank_TOPSIS = rank(-TOPSIS_Score))  # Use negative sign for descending order

# Plot the ranked nodes using a bar chart (TOPSIS)
ggplot(ranked_nodes_topsis, aes(x = reorder(Node, Rank_TOPSIS), y = TOPSIS_Score)) +
  geom_bar(stat = "identity", fill = "green") +
  geom_text(aes(label = round(TOPSIS_Score, 2)), vjust = -0.5, size = 3) +
  labs(title = "Ranked Nodes based on TOPSIS Score",
       x = "Node",
       y = "TOPSIS Score") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# rank ahp





# combined false

# Combine rankings from different methods into a single data frame
combined_rankings <- bind_rows(
  avg_overall_risk_score %>% select(Node, Rank_Avg_Score),
  ranked_nodes_ahp %>% select(Node, Rank_AHP),
  ranked_nodes_wsm %>% select(Node, Rank_WSM),
  ranked_nodes_topsis %>% select(Node, Rank_TOPSIS)
)

# Calculate the combined rank using equal weights (0.25 for each method)
ranked_nodes_combined <- combined_rankings %>%
  group_by(Node) %>%
  summarise(
    Combined_Rank = 0.25 * mean(Rank_Avg_Score, na.rm = TRUE) +
      0.25 * mean(Rank_AHP, na.rm = TRUE) +
      0.25 * mean(Rank_WSM, na.rm = TRUE) +
      0.25 * mean(Rank_TOPSIS, na.rm = TRUE)
  ) %>%
  arrange(Combined_Rank)

# Plot the combined rankings using a bar chart
ggplot(ranked_nodes_combined, aes(x = reorder(Node, Combined_Rank), y = Combined_Rank)) +
  geom_bar(stat = "identity", fill = "purple") +
  geom_text(aes(label = round(Combined_Rank, 2)), vjust = -0.5, size = 3) +
  labs(title = "Combined Ranking of Nodes",
       x = "Node",
       y = "Combined Risk Score") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))




#combined all

# Function to calculate Overall Risk Score for each consequence
calculate_overall_risk <- function(severity, likelihood, weights_severity, weights_likelihood) {
  return(severity * weights_severity + likelihood * weights_likelihood)
}

# Assume you have the data in data_all_nodes DataFrame

# Step 1: Define the Weights (arbitrary example for WSM, SL, and TOPSIS)
weight_sl_matrix <- 0.3
weight_ahp <- 0.2
weight_wsm <- 0.2
weight_topsis <- 0.3

# Step 2: Calculate Overall Risk Score for each Node (WSM)
data_all_nodes$Overall_Risk_WSM <- calculate_overall_risk(data_all_nodes$Severity, data_all_nodes$Likelihood, weight_severity, weight_likelihood)

# Step 3: Rank the Nodes based on Overall Risk Score (WSM)
ranked_nodes_wsm <- data_all_nodes %>%
  select(Node, Overall_Risk_WSM) %>%
  arrange(Overall_Risk_WSM) %>%
  mutate(Rank_WSM = rank(Overall_Risk_WSM, ties.method = "first"))

# Step 4: Normalize the Decision Matrix for TOPSIS
normalized_data <- data_all_nodes %>%
  mutate(
    Severity_Normalized = Severity / max(Severity),
    Likelihood_Normalized = Likelihood / max(Likelihood)  # Changed min to max here
  )

# Step 5: Determine the Ideal and Negative-Ideal Solutions for TOPSIS
ideal_solution <- normalized_data %>%
  summarise(
    Ideal_Severity = max(Severity_Normalized),
    Ideal_Likelihood = min(Likelihood_Normalized)
  )

negative_ideal_solution <- normalized_data %>%
  summarise(
    Negative_Ideal_Severity = min(Severity_Normalized),
    Negative_Ideal_Likelihood = max(Likelihood_Normalized)
  )

# Step 6: Calculate the Distance to Ideal Solution and Negative-Ideal Solution for TOPSIS
normalized_data <- normalized_data %>%
  mutate(
    Distance_Ideal = sqrt((Severity_Normalized - ideal_solution$Ideal_Severity)^2 + (Likelihood_Normalized - ideal_solution$Ideal_Likelihood)^2),
    Distance_Negative_Ideal = sqrt((Severity_Normalized - negative_ideal_solution$Negative_Ideal_Severity)^2 + (Likelihood_Normalized - negative_ideal_solution$Negative_Ideal_Likelihood)^2)
  )

# Step 7: Calculate the Relative Closeness to Ideal Solution for TOPSIS
normalized_data$Relative_Closeness <- normalized_data$Distance_Negative_Ideal / (normalized_data$Distance_Ideal + normalized_data$Distance_Negative_Ideal)

# Step 8: Add the Relative_Closeness column to the original data frame (data_all_nodes)
data_all_nodes$Relative_Closeness <- normalized_data$Relative_Closeness

# Step 9: Rank the Nodes based on Relative Closeness (TOPSIS)
ranked_nodes_topsis <- data_all_nodes %>%
  select(Node, Relative_Closeness) %>%
  arrange(desc(Relative_Closeness)) %>%
  mutate(Rank_TOPSIS = rank(-Relative_Closeness, ties.method = "first"))

# Calculate AHP weights for Severity and Likelihood
weights_severity <- calculate_ahp_weights(4, 2)  # Replace 4 and 2 with your own judgments
weights_likelihood <- calculate_ahp_weights(2, 1)  # Replace 2 and 1 with your own judgments

# Calculate Overall Risk Score for each consequence in each node using AHP weights
data_all_nodes$Overall_Risk_AHP <- calculate_overall_risk(data_all_nodes$Severity, data_all_nodes$Likelihood, weights_severity, weights_likelihood)

# Calculate the combined risk score for each node
data_all_nodes$Combined_Risk <- with(data_all_nodes, 
                                     (Overall_Risk_WSM * weight_wsm) +
                                       (Overall_Risk_AHP * weight_ahp) +
                                       (Relative_Closeness * weight_topsis))

# Rank the nodes based on their combined risk score in descending order
ranked_nodes_combined <- data_all_nodes %>%
  select(Node, Combined_Risk) %>%
  arrange(desc(Combined_Risk)) %>%
  mutate(Rank_Combined = rank(-Combined_Risk, ties.method = "first"))

# Aggregate data to remove duplicates and calculate mean Combined Risk for each node
aggregated_data <- data_all_nodes %>%
  group_by(Node) %>%
  summarise(Combined_Risk = mean(Combined_Risk)) %>%
  arrange(desc(Combined_Risk)) %>%
  mutate(Rank_Combined = rank(-Combined_Risk, ties.method = "first"))




# Plot the ranked nodes using a bar chart
library(ggplot2)

p_combined <- ggplot(aggregated_data, aes(x = reorder(Node, -Combined_Risk), y = Combined_Risk)) +
  geom_bar(stat = "identity", fill = "purple", width = 0.6) +
  labs(title = "Ranked Nodes by Combined Risk", x = "Node", y = "Combined Risk Level") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        axis.title.x = element_blank())

# Display the plot
print(p_combined)


# Assuming you have already performed the previous steps to calculate the Combined Risk for each node and have the data in the 'aggregated_data' DataFrame.



# Print the aggregated_data DataFrame
print(aggregated_data)

print(aggregated_data, n = 26)










